import{a2 as o,a7 as m,ac as d,a8 as v,W as l,_ as p,D as u,H as _,as as b,$ as g,Q as k,E as w,O as M,M as y,at as E,R as F,P as R}from"./ja8BvbFi.js";class x{anchor;#s=new Map;#t=new Map;#e=new Map;#a=!0;constructor(t,a=!0){this.anchor=t,this.#a=a}#r=()=>{var t=o;if(this.#s.has(t)){var a=this.#s.get(t),s=this.#t.get(a);if(s)m(s);else{var e=this.#e.get(a);e&&(this.#t.set(a,e.effect),this.#e.delete(a),e.fragment.lastChild.remove(),this.anchor.before(e.fragment),s=e.effect)}for(const[r,i]of this.#s){if(this.#s.delete(r),r===t)break;const c=this.#e.get(i);c&&(d(c.effect),this.#e.delete(i))}for(const[r,i]of this.#t){if(r===a)continue;const c=()=>{if(Array.from(this.#s.values()).includes(r)){var h=document.createDocumentFragment();b(i,h),h.append(l()),this.#e.set(r,{effect:i,fragment:h})}else d(i);this.#t.delete(r)};this.#a||!s?v(i,c,!1):c()}}};ensure(t,a){var s=o,e=g();if(a&&!this.#t.has(t)&&!this.#e.has(t))if(e){var r=document.createDocumentFragment(),i=l();r.append(i),this.#e.set(t,{effect:p(()=>a(i)),fragment:r})}else this.#t.set(t,p(()=>a(this.anchor)));if(this.#s.set(s,t),e){for(const[c,f]of this.#t)c===t?s.skipped_effects.delete(f):s.skipped_effects.add(f);for(const[c,f]of this.#e)c===t?s.skipped_effects.delete(f.effect):s.skipped_effects.add(f.effect);s.add_callback(this.#r)}else u&&(this.anchor=_),this.#r()}}function D(n,t,...a){var s=new x(n);k(()=>{const e=t()??null;s.ensure(e,e&&(r=>e(r,...a)))},F)}function T(n){return(t,...a)=>{var s=n(...a),e;if(u)e=_,w();else{var r=s.render().trim(),i=M(r);e=R(i),t.before(e)}const c=s.setup?.(e);y(e,e),typeof c=="function"&&E(c)}}export{x as B,T as c,D as s};
